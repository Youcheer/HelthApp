<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Insurance Claim Monitor</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Dexie.js (CDN) -->
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- SweetAlert2 for notifications -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Chart.js for Reports -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF & AutoTable for PDF Exports --->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            500: '#14b8a6',
                            600: '#0d9488',
                            900: '#134e4a',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
</head>

<body class="text-slate-800 transition-colors duration-300 pb-safe sm:pb-0">

    <!-- Header -->
    <nav class="bg-brand-600 dark:bg-slate-900 text-white shadow-md sticky top-0 z-40 transition-colors">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-14 items-center">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-shield-heart text-2xl drop-shadow-md"></i>
                    <span class="font-bold text-lg tracking-tight block">Health Policy Monitor</span>
                </div>

                <div class="flex items-center gap-2">
                    <button id="themeToggle" class="text-white hover:text-brand-200 transition p-2 rounded-full">
                        <i class="fa-solid fa-moon text-lg" id="themeIcon"></i>
                    </button>
                    <!-- Desktop nav hidden on mobile -->
                    <div class="hidden sm:flex space-x-1 h-full text-sm">
                        <button
                            class="tab-btn active px-3 h-14 flex items-center gap-1 hover:bg-brand-900 hover:bg-opacity-20"
                            onclick="switchTab('dashboard')"><i class="fa-solid fa-chart-line"></i> Dashboard</button>
                        <button class="tab-btn px-3 h-14 flex items-center gap-1 hover:bg-brand-900 hover:bg-opacity-20"
                            onclick="switchTab('claims')"><i class="fa-solid fa-file-invoice"></i> Claims</button>
                        <button class="tab-btn px-3 h-14 flex items-center gap-1 hover:bg-brand-900 hover:bg-opacity-20"
                            onclick="switchTab('premiums')"><i class="fa-solid fa-money-bill-transfer"></i>
                            Premiums</button>
                        <button class="tab-btn px-3 h-14 flex items-center gap-1 hover:bg-brand-900 hover:bg-opacity-20"
                            onclick="switchTab('settings')"><i class="fa-solid fa-gear"></i> Policy Config</button>
                        <button class="tab-btn px-3 h-14 flex items-center gap-1 hover:bg-brand-900 hover:bg-opacity-20"
                            onclick="switchTab('report')"><i class="fa-solid fa-chart-pie"></i> Report</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- TAB 1: DASHBOARD (SUMMARY ONLY) -->
    <div id="tab-dashboard" class="tab-content active max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div
            class="mb-6 bg-white rounded-xl shadow-sm p-6 border border-slate-100 border-l-4 border-l-brand-500 flex flex-col md:flex-row justify-between items-start md:items-center">
            <div>
                <h1 class="text-2xl font-bold text-slate-800" id="dashGreeting">Welcome, Policyholder</h1>
                <p class="text-slate-500 mt-1 flex flex-wrap items-center gap-2">
                    <span>Viewing Year:</span>
                    <select id="dashYearSelect" onchange="changeViewingYear(this.value)"
                        class="bg-brand-50 border border-brand-200 rounded px-1 py-0.5 text-brand-700 text-sm font-semibold outline-none cursor-pointer">
                    </select>
                    <span id="renewalInfo"
                        class="bg-amber-100 text-amber-800 text-[10px] px-2 py-0.5 rounded-full font-bold hidden"></span>
                </p>
                <div class="flex flex-wrap gap-2 mt-3">
                    <span class="text-sm bg-slate-100 text-slate-700 px-3 py-1.5 rounded-md font-medium"><i
                            class="fa-solid fa-hashtag text-slate-400 mr-1"></i> Policy: <span
                            id="dashPolicyNo">-</span></span>
                    <span
                        class="text-sm bg-blue-50 text-blue-700 px-3 py-1.5 rounded-md border border-blue-100 font-medium"><i
                            class="fa-solid fa-money-check-dollar text-blue-400 mr-1"></i> Paid: <span
                            id="dashPremiumPaid">Rs. 0</span></span>
                </div>
            </div>
            <div class="mt-4 md:mt-0 text-left md:text-right">
                <button onclick="switchTab('claims')"
                    class="bg-brand-600 hover:bg-brand-700 text-white px-5 py-3 sm:px-4 sm:py-2 rounded-lg font-medium shadow-sm transition-colors text-sm mb-2 sm:mb-0">
                    <i class="fa-solid fa-plus mr-1"></i> Add Claim
                </button>
                <button onclick="switchTab('premiums')"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 sm:px-4 sm:py-2 rounded-lg font-medium shadow-sm transition-colors text-sm ml-0 sm:ml-2">
                    <i class="fa-solid fa-coins mr-1"></i> Pay Premium
                </button>
            </div>
        </div>

        <!-- PREMIUM REMINDER DASHBOARD CARD -->
        <div id="dashPremiumReminder" class="mb-6 hidden"></div>

        <!-- Limits Summary Panels -->
        <div class="grid grid-cols-1 gap-6">
            <div class="bg-white rounded-xl shadow-sm p-6 border border-slate-100">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2"><i
                        class="fa-solid fa-chart-pie text-brand-500"></i> Limits Summary</h2>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10" id="progressBarsContainer">
                    <!-- Progress bars rendered here via JS -->
                </div>
            </div>
        </div>
    </div>


    <!-- TAB 2: CLAIMS (FORM + HISTORY) -->
    <div id="tab-claims" class="tab-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left: Claim History -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                        <h2 class="text-lg font-bold flex items-center gap-2"><i
                                class="fa-solid fa-clock-rotate-left text-brand-500"></i> Claim History (Year <span
                                class="tableYearDisplay">1</span>)</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm whitespace-nowrap responsive-table">
                            <thead class="bg-white text-slate-500 border-b border-slate-200">
                                <tr>
                                    <th class="px-6 py-3 font-medium">Date</th>
                                    <th class="px-6 py-3 font-medium">Category</th>
                                    <th class="px-6 py-3 font-medium flex-1">Hospital</th>
                                    <th class="px-6 py-3 font-medium text-right">Amount (Rs)</th>
                                    <th class="px-6 py-3 font-medium text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="claimsTableBody" class="divide-y divide-slate-100 bg-white">
                                <!-- Claims injected here -->
                            </tbody>
                        </table>
                        <div id="noClaimsMessage" class="hidden p-8 text-center text-slate-400 bg-white">
                            No claims submitted for this year.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Add Claim -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-sm p-6 border border-slate-100 sticky top-24">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><i
                            class="fa-solid fa-file-invoice text-brand-500"></i> Submit Claim</h2>

                    <form id="claimForm" class="space-y-4">
                        <input type="hidden" id="claimPolicyYear" value="1">

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Date of Treatment</label>
                            <input type="date" id="claimDate" required
                                class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 bg-slate-50">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Category</label>
                            <select id="claimCategory" onchange="toggleDaysInput()" required
                                class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 bg-slate-50">
                                <!-- Categories populated via JS -->
                            </select>
                        </div>

                        <div id="daysInputGroup" class="hidden">
                            <label class="block text-sm font-medium text-slate-700 mb-1">Admitted Days</label>
                            <input type="text" inputmode="numeric" id="claimDays"
                                class="number-input w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 bg-slate-50">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Amount (Rs)</label>
                            <input type="text" inputmode="decimal" id="claimAmount" required
                                class="currency-input w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 bg-slate-50">
                        </div>

                        <div>
                            <label
                                class="block text-sm font-medium text-slate-700 mb-1">Hospital/Doctor/Location</label>
                            <input type="text" id="claimHospital" required
                                class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 bg-slate-50">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Note (Optional)</label>
                            <input type="text" id="claimDescription"
                                class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 bg-slate-50">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Upload Bill (Image/PDF)
                                (Optional)</label>
                            <input type="file" id="claimFile" accept="image/png, image/jpeg, application/pdf"
                                class="w-full border border-slate-300 rounded-md p-1 text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:font-semibold file:bg-brand-50 file:text-brand-700 bg-slate-50">
                        </div>

                        <div class="flex gap-2">
                            <button type="submit" id="claimSubmitBtn"
                                class="flex-1 bg-brand-600 hover:bg-brand-700 text-white font-semibold py-2 px-4 rounded-md transition-colors shadow-sm text-sm">
                                <i class="fa-solid fa-plus mr-1"></i> Save Claim
                            </button>
                            <button type="button" id="claimCancelBtn" onclick="cancelEdit('claims')"
                                class="hidden bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold py-2 px-4 rounded-md transition-colors shadow-sm text-sm">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- TAB 3: PREMIUMS (FORM + HISTORY) -->
    <div id="tab-premiums" class="tab-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left: Premium History -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                        <h2 class="text-lg font-bold flex items-center gap-2"><i
                                class="fa-solid fa-receipt text-blue-500"></i> Premium Payment Records (All Years)</h2>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm whitespace-nowrap responsive-table">
                            <thead class="bg-white text-slate-500 border-b border-slate-200">
                                <tr>
                                    <th class="px-6 py-3 font-medium">Due Date</th>
                                    <th class="px-6 py-3 font-medium">Paid Date</th>
                                    <th class="px-6 py-3 font-medium">Policy Yr</th>
                                    <th class="px-6 py-3 font-medium text-right">Amount (Rs)</th>
                                    <th class="px-6 py-3 font-medium text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody id="premiumTableBody" class="divide-y divide-slate-100 bg-white">
                                <!-- Premiums injected here -->
                            </tbody>
                        </table>
                        <div id="noPremiumMessage" class="hidden p-8 text-center text-slate-400 bg-white">
                            No premiums recorded.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Add Premium Form -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-sm p-6 border border-slate-100 sticky top-24">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><i
                            class="fa-solid fa-coins text-blue-500"></i> Record Premium</h2>

                    <form id="premiumForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Amount Paid (Rs) *</label>
                            <input type="text" inputmode="decimal" id="premAmount" required
                                class="currency-input w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 bg-slate-50">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Due Date
                                *</label>
                            <input type="date" id="premDueDate" required readonly
                                class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 bg-slate-200 cursor-not-allowed font-medium text-slate-600"
                                title="Auto calculated based on active date and payment frequency">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Actual Paid Date *</label>
                            <input type="date" id="premPaidDate" required
                                class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 bg-slate-50">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Belongs to Policy Year
                                *</label>
                            <select id="premPolicyYear" required
                                class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 bg-slate-50">
                                <!-- Generated Dynamically -->
                            </select>
                        </div>

                        <div class="flex gap-2">
                            <button type="submit" id="premSubmitBtn"
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition-colors shadow-sm text-sm">
                                <i class="fa-solid fa-check mr-1"></i> Save Record
                            </button>
                            <button type="button" id="premCancelBtn" onclick="cancelEdit('premiums')"
                                class="hidden bg-slate-200 hover:bg-slate-300 text-slate-800 font-semibold py-2 px-4 rounded-md transition-colors shadow-sm text-sm">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- TAB 4: SETTINGS -->
    <div id="tab-settings" class="tab-content max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden mb-8">
            <div class="bg-slate-50 p-6 border-b border-slate-100">
                <h2 class="text-xl font-bold flex items-center gap-2 text-slate-800"><i
                        class="fa-solid fa-user-pen text-brand-500"></i> Policyholder Config</h2>
            </div>

            <form id="settingsForm" class="p-6 space-y-8">
                <!-- Info -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Policyholder Name</label><input
                            type="text" id="setHolderName" required
                            class="w-full rounded-md border border-slate-300 px-3 py-2"></div>
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Age</label><input type="text"
                            inputmode="numeric" id="setHolderAge"
                            class="number-input w-full rounded-md border border-slate-300 px-3 py-2"></div>
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">NIC Number</label><input
                            type="text" id="setHolderNIC" class="w-full rounded-md border border-slate-300 px-3 py-2">
                    </div>
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Policy Number</label><input
                            type="text" id="setPolicyNo" class="w-full rounded-md border border-slate-300 px-3 py-2">
                    </div>
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Policy Term
                            (Years)</label><input type="text" inputmode="numeric" id="setPolicyTerm" value="30" required
                            class="number-input w-full rounded-md border border-slate-300 px-3 py-2"></div>
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Expected Premium Amount
                            (Rs)</label><input type="text" inputmode="decimal" id="setMonthlyPremium" required
                            class="currency-input w-full rounded-md border border-slate-300 px-3 py-2"></div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Payment Frequency</label>
                        <select id="setPremiumFrequency" required
                            class="w-full rounded-md border border-slate-300 px-3 py-2">
                            <option value="Monthly">Monthly</option>
                            <option value="Quarterly">Quarterly</option>
                            <option value="Half Yearly">Half Yearly</option>
                            <option value="Yearly">Yearly</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Policy Active Date</label>
                        <input type="date" id="setActiveDate" required
                            class="w-full rounded-md border border-slate-300 px-3 py-2 font-bold text-brand-700">
                        <p class="text-xs text-brand-600 mt-1">Limits amount will renew automatically each year. Premium
                            due dates are calculated from this date.</p>
                    </div>
                </div>

                <hr class="border-slate-100">

                <h3 class="font-bold text-slate-700 mt-4"><i class="fa-solid fa-money-check-dollar"></i> Core Coverage
                    Rules</h3>
                <!-- Custom Inner limits -->
                <div class="space-y-4">
                    <div class="flex justify-between items-center mb-2 border-b border-slate-100 pb-2">
                        <label class="font-semibold text-slate-700 text-sm">Inner Limits Config (Customizable
                            Categories)</label>
                        <button type="button" onclick="addInnerLimitField()"
                            class="bg-indigo-50 text-indigo-600 hover:bg-indigo-100 px-3 py-1 rounded text-xs font-semibold"><i
                                class="fa-solid fa-plus"></i> Add Sub-Category</button>
                    </div>
                    <div id="innerLimitsContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- Dynamic fields injected here -->
                    </div>
                    <p class="text-[11px] text-slate-500">Values are percentages (%) of the Master Base Cover.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-slate-50 p-4 rounded-lg border border-slate-100">
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Master Base Cover
                            (Rs)</label><input type="text" inputmode="numeric" id="setBaseCover" required
                            class="number-input w-full rounded-md border border-slate-300 px-3 py-2 font-bold text-brand-700">
                    </div>
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Critical Illness Cover
                            (Rs)</label><input type="text" inputmode="numeric" id="setCriticalCover" required
                            class="number-input w-full rounded-md border border-slate-300 px-3 py-2 font-bold text-amber-700">
                    </div>
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Hospital (Per Day)
                            Benefit</label><input type="text" inputmode="numeric" id="setHospitalPerDay" required
                            class="number-input w-full rounded-md border border-slate-300 px-3 py-2"></div>
                    <div><label class="block text-sm font-semibold text-slate-700 mb-1">Hospital Room Limit %
                            (of Base)</label><input type="number" step="0.1" id="setHospitalRoomPct" min="0.1" required
                            class="w-full rounded-md border border-slate-300 px-3 py-2 text-brand-700 font-semibold">
                    </div>
                </div>

                <div class="bg-indigo-50 border border-indigo-100 rounded-lg p-4 mt-6">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4">
                        <div>
                            <h3 class="font-bold text-slate-800 flex items-center gap-2"><i
                                    class="fa-solid fa-file-contract text-indigo-600"></i> Policy Documents</h3>
                            <p class="text-xs text-slate-500 mt-1">Upload multiple pages of your insurance policy here
                                (Images or PDF).</p>
                        </div>
                        <div class="flex gap-2">
                            <input type="file" id="policyDocsInput" multiple accept="image/*,application/pdf"
                                class="w-full sm:w-auto text-xs text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:font-semibold file:bg-indigo-100 file:text-indigo-700 bg-white border border-slate-200 rounded">
                            <button type="button" onclick="uploadPolicyDocs()"
                                class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded font-semibold text-xs whitespace-nowrap"><i
                                    class="fa-solid fa-upload"></i> Upload</button>
                        </div>
                    </div>
                </div>

                <div id="policyDocsGallery"
                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 mt-4">
                    <!-- Dynamic docs injected here -->
                </div>


                <div class="pt-4 flex justify-end">
                    <button type="submit"
                        class="bg-brand-600 hover:bg-brand-700 text-white font-bold py-2.5 px-6 rounded-md shadow flex items-center gap-2">
                        <i class="fa-solid fa-floppy-disk"></i> Save Configuration
                    </button>
                </div>
            </form>
        </div>

        <!-- System Backup / Restore -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden mb-8">
            <div class="bg-slate-50 p-6 border-b border-slate-100 flex justify-between items-center">
                <h2 class="text-lg font-bold flex items-center gap-2 text-slate-800"><i
                        class="fa-solid fa-database text-blue-500"></i> Backup & Restore</h2>
            </div>
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="font-bold text-slate-700 mb-2">Export Data</h3>
                    <p class="text-sm text-slate-500 mb-4">Download a complete backup of all your policy settings,
                        premium records, and claim history as a JSON file.</p>
                    <button onclick="exportData()"
                        class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-medium">
                        <i class="fa-solid fa-download"></i> Download Backup
                    </button>
                </div>
                <div>
                    <h3 class="font-bold text-slate-700 mb-2">Import Data</h3>
                    <p class="text-sm text-slate-500 mb-4">Restore your system using a previously saved JSON backup
                        file. <span class="text-rose-500 font-semibold">Warning: This will overwrite current
                            data!</span></p>
                    <div class="flex gap-2">
                        <input type="file" id="importFile" accept=".json"
                            class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 border border-slate-200 rounded-md">
                        <button onclick="importData()"
                            class="bg-slate-800 hover:bg-slate-900 text-white py-2 px-4 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-medium shrink-0">
                            <i class="fa-solid fa-upload"></i> Restore
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cloud Sync (Google Sheets) -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
            <div class="bg-indigo-50 p-6 border-b border-indigo-100 flex justify-between items-center">
                <h2 class="text-lg font-bold flex items-center gap-2 text-indigo-800"><i
                        class="fa-brands fa-google text-indigo-500"></i> Cloud Sync (Google Sheet)</h2>
            </div>
            <div class="p-6 space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-1">Google App Script Web App URL</label>
                    <input type="url" id="googleWebAppUrl" placeholder="https://script.google.com/macros/s/.../exec"
                        value="https://script.google.com/macros/s/AKfycbx2XJu680k4PFdmN5Mr1L89NBCqGD7C4k8J63YHmSd7Q41ngt8fa3brdTvGj1r3iJsd/exec"
                        class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:ring-2 focus:ring-indigo-500 bg-slate-50">
                    <p class="text-[11px] text-slate-500 mt-1">Deploy the provided Google Apps Script in your sheet, set
                        access to "Anyone", and paste the script URL here.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-slate-50 border border-slate-100 rounded-lg p-5">
                        <h3 class="font-bold text-slate-700 mb-2 flex items-center gap-2"><i
                                class="fa-solid fa-cloud-arrow-up text-indigo-500"></i> Save to Cloud</h3>
                        <p class="text-sm text-slate-500 mb-4">Back up your current claims, premiums, and configuration
                            securely to your Google Sheet.</p>
                        <button onclick="syncToCloud()"
                            class="w-full justify-center bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-semibold">
                            Save Data Online
                        </button>
                    </div>
                    <div class="bg-slate-50 border border-slate-100 rounded-lg p-5">
                        <h3 class="font-bold text-slate-700 mb-2 flex items-center gap-2"><i
                                class="fa-solid fa-cloud-arrow-down text-indigo-500"></i> Load from Cloud</h3>
                        <p class="text-sm text-slate-500 mb-4">Restore your latest data from Google Sheet. <span
                                class="text-rose-500 font-semibold block">Will replace current data!</span></p>
                        <button onclick="syncFromCloud()"
                            class="w-full justify-center bg-slate-800 hover:bg-slate-900 text-white py-2 px-4 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-semibold">
                            Sync Data to Mobile
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="bg-white rounded-xl shadow-sm border border-rose-100 overflow-hidden mt-8">
            <div class="bg-rose-50 p-6 border-b border-rose-100 flex justify-between items-center">
                <h2 class="text-lg font-bold flex items-center gap-2 text-rose-700"><i
                        class="fa-solid fa-triangle-exclamation text-rose-500"></i> Danger Zone</h2>
            </div>
            <div class="p-6">
                <h3 class="font-bold text-slate-700 mb-2">Factory Reset</h3>
                <p class="text-sm text-slate-500 mb-4">Erase all saved claims, premium records, uploaded documents, and
                    policy settings. <span class="text-rose-500 font-semibold block">This cannot be undone!</span></p>
                <button onclick="resetData()"
                    class="bg-rose-600 hover:bg-rose-700 text-white py-2 px-6 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-medium">
                    <i class="fa-solid fa-trash-can"></i> Reset & Delete All Data
                </button>
            </div>
        </div>
    </div>


    <!-- TAB 5: REPORT -->
    <div id="tab-report" class="tab-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- New PDF Export Actions Header -->
        <div
            class="bg-white rounded-xl shadow-sm border border-slate-100 p-6 mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h2 class="text-xl font-bold flex items-center gap-2 text-slate-800"><i
                        class="fa-solid fa-file-pdf text-red-500"></i> Export Reports</h2>
                <p class="text-slate-500 text-sm mt-1">Download specific records or full summaries as PDF documents.</p>
            </div>
            <div class="flex flex-wrap gap-3 w-full md:w-auto justify-start md:justify-end">
                <button onclick="exportSummaryPDF()"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-medium">
                    <i class="fa-solid fa-chart-pie"></i> Policy Summary
                </button>
                <button onclick="exportClaimsPDF()"
                    class="bg-brand-600 hover:bg-brand-700 text-white py-2 px-4 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-medium">
                    <i class="fa-solid fa-stethoscope"></i> Claims History
                </button>
                <button onclick="exportPremiumsPDF()"
                    class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-medium">
                    <i class="fa-solid fa-coins"></i> Premium Payments
                </button>
                <button onclick="exportBenefitsPDF()"
                    class="bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-md shadow-sm transition flex gap-2 items-center text-sm font-medium">
                    <i class="fa-solid fa-gift"></i> Benefits Report
                </button>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
            <div class="bg-slate-800 p-6 text-white flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold"><i class="fa-solid fa-chart-line text-brand-400 mr-2"></i>Policy
                        Dashboard & Analytics</h2>
                    <p class="text-slate-300 text-sm mt-1">Based on actual recorded premiums vs. claims up to the
                        current date.</p>
                </div>
                <button onclick="renderReportTab()"
                    class="bg-slate-700 hover:bg-slate-600 px-3 py-1.5 rounded transition">Refresh</button>
            </div>

            <div class="p-6">
                <!-- Stat Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div
                        class="bg-white border text-left border-slate-100 border-l-4 border-l-blue-500 rounded-xl p-6 shadow-md shadow-slate-200/50">
                        <div class="flex justify-between items-start">
                            <p class="text-[11px] font-bold text-slate-500 mb-1 uppercase tracking-wider">Total Paid
                                (Actual)</p>
                            <div class="bg-blue-50 p-2 rounded-lg"><i
                                    class="fa-solid fa-money-bill-wave text-blue-500 text-lg"></i></div>
                        </div>
                        <h3 class="text-3xl font-black text-slate-800 mt-3" id="repTotalPaid">Rs. 0</h3>
                        <p class="text-xs text-slate-400 mt-2 font-medium">Sum of all recorded premium payments</p>
                    </div>

                    <div
                        class="bg-white border text-left border-slate-100 border-l-4 border-l-teal-500 rounded-xl p-6 shadow-md shadow-slate-200/50">
                        <div class="flex justify-between items-start">
                            <p class="text-[11px] font-bold text-slate-500 mb-1 uppercase tracking-wider">Total Claimed
                                (All Time)</p>
                            <div class="bg-teal-50 p-2 rounded-lg"><i
                                    class="fa-solid fa-hand-holding-medical text-teal-500 text-lg"></i></div>
                        </div>
                        <h3 class="text-3xl font-black text-slate-800 mt-3" id="repTotalClaimed">Rs. 0</h3>
                        <p class="text-xs text-slate-400 mt-2 font-medium">Across all categories & years</p>
                    </div>

                    <div id="repRoiCard"
                        class="bg-white border text-left border-slate-100 border-l-4 border-l-purple-500 rounded-xl p-6 shadow-md shadow-slate-200/50">
                        <div class="flex justify-between items-start">
                            <p class="text-[11px] font-bold text-slate-500 mb-1 uppercase tracking-wider"
                                id="repRoiTitle">Claim-to-Premium Ratio</p>
                            <div class="bg-purple-50 p-2 rounded-lg"><i id="repRoiIcon"
                                    class="fa-solid fa-percent text-purple-500 text-lg"></i></div>
                        </div>
                        <h3 class="text-3xl font-black text-slate-800 mt-3" id="repRoiValue">0%</h3>
                        <p class="text-xs text-slate-400 mt-2 font-medium" id="repRoiText">Claims as a % of Paid Premium
                        </p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white border border-slate-100 rounded-xl p-6 shadow-sm">
                        <h3 class="text-center font-bold text-slate-500 mb-4 text-xs uppercase tracking-wider">Claims
                            Breakdown by Category (Doughnut)</h3>
                        <div class="relative h-64 w-full flex justify-center"><canvas id="roiPieChart"></canvas></div>
                    </div>
                    <div class="bg-white border border-slate-100 rounded-xl p-6 shadow-sm">
                        <h3 class="text-center font-bold text-slate-500 mb-4 text-xs uppercase tracking-wider">Claims
                            Breakdown by Category (Bar)</h3>
                        <div class="relative h-64 w-full flex justify-center"><canvas id="catBarChart"></canvas></div>
                    </div>
                    <div class="bg-white border border-slate-100 rounded-xl p-6 shadow-sm">
                        <h3 class="text-center font-bold text-slate-500 mb-4 text-xs uppercase tracking-wider">Premiums
                            vs Claims (Total - Pie)</h3>
                        <div class="relative h-64 w-full flex justify-center"><canvas id="yearPieChart"></canvas></div>
                    </div>
                    <div class="bg-white border border-slate-100 rounded-xl p-6 shadow-sm">
                        <h3 class="text-center font-bold text-slate-500 mb-4 text-xs uppercase tracking-wider">Premiums
                            vs Claims (Yearly - Bar)</h3>
                        <div class="relative h-64 w-full flex justify-center"><canvas id="yearBarChart"></canvas></div>
                    </div>
                </div>

                <!-- Benefits Enjoyed / Utilization Report -->
                <div class="mt-10 pt-8 border-t border-slate-100">
                    <h2 class="text-xl font-bold mb-1 flex items-center gap-2 text-slate-800">
                        <i class="fa-solid fa-gift text-brand-500"></i> Benefits Enjoyed & Utilization
                    </h2>
                    <p class="text-slate-500 text-sm mb-6">Detailed breakdown of all benefits claimed against this
                        policy, grouped by year.</p>
                    <div id="benefitsReportContainer">
                        <!-- JS injects the report here -->
                    </div>
                </div>

            </div>
        </div>
    </div>


    <!-- Modals -->
    <div id="documentModal"
        class="fixed inset-0 z-50 hidden bg-slate-900 bg-opacity-75 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 class="text-lg font-bold text-slate-800" id="modalTitle">Document</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600"><i
                        class="fa-solid fa-xmark text-xl w-6 h-6"></i></button>
            </div>
            <div class="p-6 overflow-auto flex-1 flex justify-center items-center bg-slate-100" id="modalContent"></div>
            <div class="px-6 py-4 border-t border-slate-100 flex justify-end">
                <button onclick="closeModal()"
                    class="bg-slate-200 hover:bg-slate-300 text-slate-800 py-2 px-6 rounded-md">Close</button>
            </div>
        </div>
    </div>

    <!-- Application Logic -->
    <script src="app.js"></script>

    <!-- Copyright Footer -->
    <div class="mt-12 mb-20 sm:mb-6 text-center">
        <p class="text-[10px] text-slate-400 dark:text-slate-500 tracking-wide transition-colors">
            &copy; 2026 Health Policy Monitor &bull; Developed by <span class="font-medium">Suraj Sanjaya</span>
        </p>
    </div>

    <!-- Bottom Navigation Bar for Mobile -->
    <div
        class="sm:hidden fixed bottom-0 left-0 right-0 w-full bg-white dark:bg-slate-900 border-t border-slate-200 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] z-50 flex justify-around items-center pt-2 pb-2 transition-colors">
        <button class="tab-btn active flex flex-col items-center justify-center w-full text-slate-500"
            onclick="switchTab('dashboard')">
            <i class="fa-solid fa-chart-line text-[1.4rem] mb-1"></i>
            <span class="text-[0.65rem] font-medium leading-none">Home</span>
        </button>
        <button class="tab-btn flex flex-col items-center justify-center w-full text-slate-500"
            onclick="switchTab('claims')">
            <i class="fa-solid fa-file-invoice text-[1.4rem] mb-1"></i>
            <span class="text-[0.65rem] font-medium leading-none">Claims</span>
        </button>
        <button class="tab-btn flex flex-col items-center justify-center w-full text-slate-500"
            onclick="switchTab('premiums')">
            <i class="fa-solid fa-money-bill-transfer text-[1.4rem] mb-1"></i>
            <span class="text-[0.65rem] font-medium leading-none">Pays</span>
        </button>
        <button class="tab-btn flex flex-col items-center justify-center w-full text-slate-500"
            onclick="switchTab('settings')">
            <i class="fa-solid fa-gear text-[1.4rem] mb-1"></i>
            <span class="text-[0.65rem] font-medium leading-none">Policy Config</span>
        </button>
        <button class="tab-btn flex flex-col items-center justify-center w-full text-slate-500"
            onclick="switchTab('report')">
            <i class="fa-solid fa-chart-pie text-[1.4rem] mb-1"></i>
            <span class="text-[0.65rem] font-medium leading-none">Report</span>
        </button>
    </div>
</body>

</html>